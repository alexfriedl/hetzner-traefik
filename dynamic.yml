http:
  routers:
    cv-api:
      rule: "Host(`hetzner.cwwk.cloud`) && PathPrefix(`/api/cv-entries`)"
      service: cv
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      priority: 20

    cv-admin:
      rule: "Host(`hetzner.cwwk.cloud`) && PathPrefix(`/admin`)"
      service: cv
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - basic-auth
      priority: 20

    cv:
      rule: "Host(`hetzner.cwwk.cloud`) && PathPrefix(`/cv`)"
      service: cv
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - cv-strip
        - basic-auth
      priority: 10

    bewerber:
      rule: "Host(`hetzner.cwwk.cloud`) && PathPrefix(`/bewerber`)"
      service: bewerber
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - bewerber-strip
        - basic-auth
      priority: 10

    cadvisor:
      rule: "Host(`hetzner.cwwk.cloud`) && PathPrefix(`/cadvisor`)"
      service: cadvisor
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - basic-auth
      priority: 10

    scraper:
      rule: "Host(`hetzner.cwwk.cloud`)"
      service: scraper
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - basic-auth
      priority: 1

  middlewares:
    basic-auth:
      basicAuth:
        users:
          - "alex:$apr1$MDscl6wF$LKJsgIc0e1Rq5BseJVNLw/"
    bewerber-strip:
      stripPrefix:
        prefixes:
          - "/bewerber"
    cv-strip:
      stripPrefix:
        prefixes:
          - "/cv"
    cadvisor-strip:
      stripPrefix:
        prefixes:
          - "/cadvisor"

  services:
    scraper:
      loadBalancer:
        servers:
          - url: "http://scraper:3000"

    bewerber:
      loadBalancer:
        servers:
          - url: "http://auto-bewerber:3001"

    cv:
      loadBalancer:
        servers:
          - url: "http://cv-service:3002"

    cadvisor:
      loadBalancer:
        servers:
          - url: "http://cadvisor:8080"
